# Execution Testing Framework

This framework tests how Claude would approach executing the task decompositions generated by chopstack, **without making expensive API calls or file changes**.

## How It Works

Uses Claude Code's `--permission-mode plan` to get execution plans without actual implementation:

1. **TaskOrchestrator** updated with `planMode` parameter
2. **ExecutionPlanAnalyzer** extracts and analyzes Claude's execution thinking
3. **Tests validate** plan quality, structure, and technical accuracy

## Key Benefits

- âœ… **No API costs** for actual implementation
- âœ… **No file changes** to test repositories  
- âœ… **Real Claude reasoning** (not mocks)
- âœ… **Quality metrics** and comparative analysis

## Running Tests

```bash
# Run execution tests only
pnpm run test:execution

# Run all tests (includes E2E)
pnpm run test
```

## Test Structure

### `plan-execution.test.ts`
Main test suite that:
- Generates a plan using chopstack decompose
- Tests each task's execution planning in plan mode
- Analyzes plan quality and technical details
- Provides comparative analysis across tasks

### Analysis Metrics
- **Quality Score**: 0-100 based on steps, technical details, file mentions
- **Complexity**: Low/Medium/High based on scope and word count
- **File Operations**: Tracks creates vs modifies
- **Technologies**: Detects React, TypeScript, CSS, etc.

## Example Output

```
ðŸ“Š Plan analysis:
   Quality: 85/100
   Steps: 6
   Complexity: medium
   File operations: 3
   Technologies: react, typescript, context

ðŸ“ˆ Comparative Analysis:
   Average quality: 78.5/100
   Average complexity: 2.1/3
   Total file operations: 12
   Highest quality: Create ThemeContext (92)
   Lowest quality: Update CSS variables (65)
```

## Architecture Integration

The execution testing framework integrates with:

- **Decomposer**: Uses generated plans as input
- **TaskOrchestrator**: Enhanced with plan mode support
- **MCP Server**: Tools can be tested in plan mode
- **Git Workflow**: Worktree operations remain unchanged

## Cost Analysis

- **Decompose command**: ~$0.60 (generates the plan)
- **Plan mode per task**: ~$0.10-0.20 (just planning, no implementation)
- **Total test cost**: ~$1-3 vs $20-50+ for full implementation

This allows comprehensive testing of execution logic at a fraction of the cost of live implementation testing.